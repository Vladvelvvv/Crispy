{% extends "main/base.html" %}
{% load static %}
{% load goods_tags %}

{% block css %}
    <link rel="stylesheet" href="{% static "1. catalog\source\styles\catalog.css" %}">
    <link rel="stylesheet" href="{% static "source\styles\bg-images\catalog-bg-image\catalog-bg-image.css" %}">
{% endblock %}

{% block content %}    
</body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-lg-2">
            </div>
            <div class="col-lg-8 col-md-12">
                <div class="row">
                    <div class="dropdown mb-2" style="padding-top:70px">
                            <button class="btn btn-secondary dropdown-toggle btn-dark" type="button" data-bs-toggle="dropdown"
                                aria-expanded="false">
                                Фильтры
                            </button>
                    
                            <form action="{% if request.GET.q %}{% url "goods:search" %}{% else %}{% url "goods:catalog" slug_url %}{% endif %}" method="get" class="dropdown-menu bg-dark" data-bs-theme="dark">
                                <div class="form-check text-white mx-3">
                                    <input class="form-check-input" type="checkbox" name="on_sale" id="flexCheckDefault" value="on" {% if request.GET.on_sale == 'on' %}checked{% endif %}>
                                    {% if request.GET.q %}
                                        <input type="hidden" name="q" value="{{request.GET.q}}">
                                    {% endif %}
                                    
                                    <label class="form-check-label" for="flexCheckDefault">
                                        Товары по акции
                                    </label>
                                </div>
                                <p class="text-white mx-3 mt-3">Сортировать:</p>
                                <div class="form-check text-white mx-3">
                                    <input class="form-check-input" type="radio" name="order_by" id="flexRadioDefault1" value="default" {% if not request.GET.order_by or request.GET.order_by == 'default' %}checked{% endif %}>
                                    <label class="form-check-label" for="flexRadioDefault1">
                                        По умолчанию
                                    </label>
                                </div>
                                <div class="form-check text-white mx-3">
                                    <input class="form-check-input" type="radio" name="order_by" id="flexRadioDefault2" value="price" {% if request.GET.order_by == 'price' %}checked{% endif %}>
                                    <label class="form-check-label" for="flexRadioDefault2">
                                        От дешевых к дорогим
                                    </label>
                                </div>
                                <div class="form-check text-white mx-3">
                                    <input class="form-check-input" type="radio" name="order_by" id="flexRadioDefault3" value="-price" {% if request.GET.order_by == '-price' %}checked{% endif %}>
                                    <label class="form-check-label" for="flexRadioDefault3">
                                        От дорогих к дешевым
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-primary mx-3 mt-3">Применить</button>
                            </form>
                        </div>
                    {% for product in products %}
                        <div class="col-lg-3 col-md-6 mt-4">
                            <div class="card">
                                <a  href="{% url "goods:product" product.slug %}">
                                    {% if product.image %}
                                        <img src="{{ product.image.url }}" class="card-img-top"
                                        alt="{{product.name}}">
                                    {% else %}
                                        <img src="{% static "source\images\Not found image.png" %}" class="card-img-top" alt="Изображение товара отсутствует">
                                    {% endif %}
                                </a>
                                <a  href="{% url "goods:product" product.slug %}">
                                    <div class="card-body">
                                        <h5 class="card-title">{{ product.name }}</h5>
                                        <div class="product-description" style="height:80px">
                                            <p class="card-text">
                                                {{product.description|truncatechars:45}}
                                            </p>
                                        </div>
                                        <div class="product_price" style="height:100px">
                                            {% if product.discount %}
                                                <p><s> Обычная цена: {{ product.price }} </s></p>
                                                <p><strong>Цена со скидкой: {{ product.sell_price }} рублей</strong></p>
                                            {% else %}
                                                <p>Цена: {{product.price}} рублей</p>
                                            {% endif %}
                                        </div>
                                        <a href="#" class="btn btn-primary">Добавить в корзину</a>
                                    </div>
                                </a>
                            </div>
                        </div>
                    {% endfor %}

                    <div class="col-lg-12 col-md-12 text-center mt-4">
                        <p>Есть вопросы? Напишите нам в директ!</p>
                    </div>
                    <div class="col-lg-12 col-md-12 text-center">
                        <p><a href="https://www.instagram.com/direct/t/102299521419536" target="_blank"><img
                                    class="call-anim" style="width: 40px" src="{% static "source\files\direct.jpg" %}"
                                    alt="Наш директ"></a></p>
                    </div>

                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center my-4">
                            <div class="custom-shadow d-flex">
                                <li class="page-item {% if not products.has_previous %}disabled{% endif %}">
                                    <a class="page-link" href="{% if products.has_previous %}?{% change_params page=products.previous_page_number %}{% else %}#{% endif %}">Назад</a>
                                </li>
                                
                                {% for page in products.paginator.page_range %}
                                    {% if  page >= products.number|add:-2 and page <= products.number|add:2 %}
                                        <li class="page-item {% if products.number == page %} active {% endif %}">
                                            <a class="page-link" href="?{% change_params page=page %}">{{ page }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                

                                <li class="page-item {% if not products.has_next %}disabled{% endif %}">
                                    <a class="page-link" href="{% if products.has_next %}?{% change_params page=products.next_page_number %}{% else %}#{% endif %}">Следующая</a>
                                </li>
                            </div>
                        </ul>
                    </nav>

                </div>
            </div>
            <div class="col-lg-2 col-md-12">
                <div class="row px-2">
                    <div class="col-lg-12 sidebar my-4">

                    </div>
                    <div class="col-lg-12 sidebar my-4">

                    </div>
                    <div class="col-lg-12 sidebar my-4">

                    </div>
                    <div class="col-lg-12 sidebar my-4">

                    </div>
                </div>
            </div>

        </div>
    </div>
{% endblock %}